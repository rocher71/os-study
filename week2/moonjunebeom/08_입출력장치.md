# 장치 컨트롤러와 장치 드라이버

## 장치 컨트롤러

- 입출력 장치를 다루기 어려운 이유
    - 다수의 입출력 장치
    - 낮은 데이터 전송률( CPU-메모리에 비해)
        - 전송률 : 데이터를 얼마나 빨리 있는가

→ 입출력 장치 : 장치 컨트롤러로 연결 ( 컴퓨터에 직접 연결 X )

- 역할
    - CPU와 입출력장치 간 통신 중개
    - 오류 검출
    - 데이터 버퍼링
        - 전송률 차이 완화
- 내부 구조
    - 데이터 레지스터
        - CPU - 입출력장치 주고받을 데이터 보관 ( 버퍼 역할 )
        - RAM으로 대체 가능
    - 상태 레지스터
        - 입출력 장치의 상태 정보 저장
    - 제어 레지스터
        - 입출력 장치가 수행할 제어 정보, 명령 저장
    

## 장치 드라이버

- 장치 컨트롤러의 동작 감지/ 제어 → 컴퓨터 내부와 정보 통신
- 입출력 장치를 연결하기 위한 SW통로

![image.png](attachment:f08ae574-c4d0-43ce-9d81-af72127d3e7c:image.png)

# 다양한 입출력 방법

장치 컨트롤러와 CPU의 정보 통신 방법

## 프로그램 입출력

- 프로그램 속 명령어로 입출력 제어
    - CPU가 입출력 명령어 만나면 장치 컨트롤러와 상호작용하여 입출력 작업 수행
1. CPU가 제어 레지스터(장치 컨트롤러 )에 명령 전송
2. 장치 컨트롤러가 장치 상태 확인 → 상태 레지스터에 표시
3. CPU가 상태 레지스터로 장치의 상태 파악
    1. 가능? → 데이터 레지스터로 정보 통신

CPU가 여러 장치 컨트롤러 속 레지스터를 파악하고 명령하는 방법

→ 메모리 맵 입출력 / 고립형 입출력

### 메모리 맵 입출력

- 메모리 위한 주소 공간, 입출력 장치 위한 주소 공간 → 하나의 주소 공간으로 간주
    - 주소 n개 표현 가능?
        - n/2개 : 메모리 주소 표현
        - n/2개 : 장치 컨트롤러 레지스터 표현
    - CPU : 장치 컨트롤러 레지스터를 똑같이 메모리 주소처럼 관리
        - 명령어도 동일
        

![image.png](attachment:42698637-e995-40a2-904d-7f26a2ef3853:image.png)

### 고립형 입출력

- 메모리 위한 주소공 간, 입출력 장치 위한 주소 공간 분리
- CPU : 메모리, 장치 컨트롤러 따로 관리
    - 명령어 다름

![image.png](attachment:7da9d900-cf86-43fb-bc42-6272b2c1978c:image.png)

## 인터럽트 기반 입출력

장치 컨트롤러가 인터럽트 발생 → CPU : 인터럽트 서비스 루틴 수행

동시에 인터럽트가 여러개 온다면?

→ 순차적 해결? : 우선순위 적용 불가

- PIC( 프로그래머블 인터럽트 컨트롤러 ) : 우선순위 반영 다중 인터럽트 처리 위한 HW
    - 플래그 레지스터의 인터럽트 비트 활성화 된 경우
    - 인터럽트 비활성화해도 무시 불가능 인터럽트(NMI) 발생
    - 인터럽트 요청들 우선순위 판별, CPU에 알려줌

![image.png](attachment:ab9f96ab-ceb7-4aa9-a196-7cb38c108bdf:image.png)

![image.png](attachment:794b30b8-48dd-4b32-b60d-10b2f747a713:image.png)

![image.png](attachment:f0ff0e6f-115f-419b-b0e1-dbf37e176a53:image.png)

→ NMI : 순위 가장 높음. PIC가 계산 X

## DMA 입출력

- 입출력 장치, 메모리가 CPU없이 서로 상호작용
- DMA 컨트롤러에 의해 수행

### DMA 입출력 과정

1. CPU가 DMA 컨트롤러에 입출력 작업 명령
2. DMA 컨트롤러 : 장치 컨트롤러, 메모리와 상호작용, 입출력 수행
3. DMA 컨트롤러 : 작업 종료 시 CPU에 인터럽트 ( 작업 끝났음 알림 )

![image.png](attachment:b3f80f5b-f03b-44bd-b6d6-f114df8cf019:image.png)

- 시스템 버스 : 동시 이용 불가능
    - CPU가 이용 X일 때 사용
    - CPU에 허락 구하고 집중적 사용

### 입출력 버스

시스템 버스만 있다면

- 시스템 버스만 있다면 DMA 입출력 시 시스템 버스 2번 사용
    - 메모리 → DMA 컨트롤러
    - DMA 컨트롤러 → 장치 컨트롤러
- 입출력 버스 : DMA 컨트롤러와 장치 컨트롤러를 별도 연결

![image.png](attachment:318dd9c1-291e-45df-9c78-096270d16852:image.png)
